<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    #map { height: 98vh; }

  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
  integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
  crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
  integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
  crossorigin=""></script>
</head>
<body>
    <div id="map"></div>
    <!-- <svg></svg> -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script>
        var map = new L.Map("map", {center: [1.352083, 103.851959], zoom: 12})
        .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));

        var svg = d3.select(map.getPanes().overlayPane).append("svg"),
        g = svg.append("g").attr("class", "leaflet-zoom-hide");

        // Load external data
        Promise.all([d3.json("sgmap.json"), d3.csv("population2021.csv")]).then(data => {

            console.log(data[0]);
            console.log(data[1]);

            var transform = d3.geoTransform({point: projectPoint}),
            path = d3.geoPath().projection(transform);

            var feature = g.selectAll("path")
                .data(data[0].features)
                .enter().append("path")
                .attr('fill-opacity', 0.3)
                .attr('stroke', 'black')
                .attr("z-index", 3000)
                .attr('stroke-width', 2.5)
                .on("mouseover", function(d){
                    console.log("test")
                    d3.select(this).attr("fill", "red")
                })
                .on("mouseout", function(d){
                    d3.select(this).attr("fill", "black")
                });;
                

            map.on("moveend", reset);
            reset();

            // Reposition the SVG to cover the features.
            function reset() {
                var bounds = path.bounds(data[0]),
                    topLeft = bounds[0],
                    bottomRight = bounds[1];
                console.log(bounds)

                svg.attr("width", bottomRight[0] - topLeft[0])
                    .attr("height", bottomRight[1] - topLeft[1])
                    .style("left", topLeft[0] + "px")
                    .style("top", topLeft[1] + "px");

                g.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

                feature.attr("d", path)
                
            }

            // Use Leaflet to implement a D3 geometric transformation.
            function projectPoint(x, y) {
                var point = map.latLngToLayerPoint(new L.LatLng(y, x));
                this.stream.point(point.x, point.y);
            }
        })

    </script>

</body>
</html>